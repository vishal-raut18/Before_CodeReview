@using System.Collections.Generic
@model List<MyMvcApp.Models.TicketModel>
@{
    ViewBag.Title = "Tickets";
    Layout = "~/Views/Shared/_Layout.cshtml";
}<div style="background-color: white; padding: 20px 30px; margin-right: -30px; height:80vh !important;">
    <div class="d-flex justify-content-between align-items-center mb-3  ">
        <span class="d-flex align-items-center mb-0" style="font-family: ' Open Sans', 'Segoe UI' !important; font-size: 18px; color: #0091ff; ">
            Incoming Ticket Report
            <span class="ml-0" style="color: inherit;">
                <!-- Column Dropdown -->


                <div class="dropdown grid-filter">
                    <button class="btn dropdown-toggle px-2 py-1 text-muted small ab" type="button" data-bs-toggle="dropdown"
                            style="font-family: 'Open Sans', 'Segoe UI'; border:none !important;">
                        <i class="bi bi-filter-circle me-1" style="font-size: 23px; width: 80px;"></i>
                    </button>

                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">All</a></li>
                        <li><a class="dropdown-item" href="#">Active</a></li>
                        <li><a class="dropdown-item" href="#">Closed</a></li>
                        <li><a class="dropdown-item" href="#">My Ticket</a></li>
                        <li><a class="dropdown-item" href="#">Un Assigned</a></li>
                    </ul>
                </div>

            </span>
        </span>
        <div class="d-flex align-items-center" style="gap: 14px; margin-right: 5px;">

            <!-- Actions Styled Dropdown Box -->

            @Html.Partial("_ActionDropdown")




            <!-- New Ticket Button (Outlined Green) -->
            <button class="btn  btn-sm d-flex align-items-center justify-content-center px-3 py-1 new-ticket-btn"
                    data-bs-toggle="modal" data-bs-target="#newTicketModal">

                NEW TICKET
            </button>

            <!-- Export Report Styled Dropdown Box -->
            <div>
                <button class="btn btn-sm  text-white  d-flex align-items-center px-3"
                        type="button" data-bs-toggle="dropdown" aria-expanded="false"
                        style="height: 23px; border-radius: 6px; font-family: ' Open Sans', 'Segoe UI'; font-size: 10px; background-color: #0091ff; font-weight:600;">
                    EXPORT REPORT <i class="bi bi-chevron-down" style="margin-left:6px;"></i>
                </button>
            </div>

        </div>



    </div>


    <div class="controls-bar row g-2 align-items-center mb-3">
        <div class="col-md-12 d-flex flex-wrap align-items-center"
             style="gap: 16px; font-family: 'Open Sans', 'Segoe UI'; font-size: 13px;">

            <!-- Filter Dropdown -->
            <div class="dropdown">
                <button class="btn dropdown-toggle p-0 " type="button" data-bs-toggle="dropdown" style="font-size: 13px;">
                    <i class="bi bi-funnel-fill me-1"></i> Filters
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Open</a></li>
                    <li><a class="dropdown-item" href="#">In Progress</a></li>
                    <li><a class="dropdown-item" href="#">Closed</a></li>
                </ul>
            </div>

            <!-- Group Dropdown -->
            <div class="dropdown">
                <button class="btn dropdown-toggle p-0  " type="button" data-bs-toggle="dropdown" style="font-size: 13px;">
                    <i class="bi bi-person-vcard-fill me-1"></i> Groups
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Default</a></li>
                    <li><a class="dropdown-item" href="#">Custom</a></li>
                </ul>
            </div>

            <!-- Custom Search Box -->
            <div id="customSearchWrapper" style="padding-top: 1px;">
                <div class="position-relative" id="searchContainer" style="min-width: 100px; transition: width 0.3s;">
                    <i class="bi bi-search position-absolute"
                       style="top: 50%; left: 8px; transform: translateY(-50%); color: black; font-size: 13px;"></i>

                    <i class="bi bi-x-lg position-absolute clear-icon"
                       id="clearSearch"
                       style="top: 50%; right: 8px; transform: translateY(-50%); color: #888; font-size: 11px;
              cursor: pointer; display: none; z-index: 10;"></i>

                    <input type="text" id="customSearch"
                           class="form-control form-control-sm border-0 shadow-none"
                           placeholder="Search"
                           style="background-color: transparent; border-bottom: 1px solid #ccc; border-radius: 0;
                  padding-left: 30px; padding-right: 20px; font-size: 13px; font-family: 'Open Sans', 'Segoe UI';
                  transition: width 0.3s;" />
                </div>

            </div>
            <!-- Selection Badge (Initially Hidden) -->

            <div id="selectionBadge"
                 class="d-flex align-items-center ms-1 px-3 py-1 rounded-pill text-white d-none"
                 style="background-color: #0091ff; font-size: 13px; height: 30px;">

                <span>Selected <span id="selectedCount">0</span></span>

                <button type="button"
                        class="ms-2 d-flex align-items-center justify-content-center p-0"
                        onclick="clearSelection()"
                        style="width: 18px; height: 18px; border-radius: 50%; background-color: #fff; border: none;">
                    <span style="font-size: 12px; color: #0091ff; line-height: 1;">×</span>
                </button>
            </div>




            <!-- Spacer -->
            <div class="flex-grow-1"></div>

            <!-- Right-side Controls -->
            <div class="d-flex align-items-center" style="gap: 6px; font-family: 'Open Sans', 'Segoe UI';">

                <!-- Column Dropdown -->
                <div class="dropdown">
                    <button class="btn dropdown-toggle px-2 py-1 " type="button" data-bs-toggle="dropdown" style="font-size: 13px;">
                        <i class="bi bi-layout-text-sidebar me-1"></i> Columns
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">Default</a></li>
                        <li><a class="dropdown-item" href="#">Custom</a></li>
                    </ul>
                </div>

                <!-- Settings Icon -->
                <button class="btn btn-sm btn-light d-flex align-items-center justify-content-center"
                        style="width: 30px; height: 30px; border-radius: 4px;" title="Settings">
                    <i class="bi bi-gear"></i>
                </button>

                <!-- Zoom In Icon -->
                <button class="btn btn-sm btn-light d-flex align-items-center justify-content-center"
                        style="width: 30px; height: 30px; border-radius: 4px;" title="Zoom In">
                    <i class="bi bi-fullscreen"></i>
                </button>
            </div>
        </div>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Message"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div id="ticketGridWrapper" style="margin-left:-20px;  height: calc(100vh - 200px); overflow: hidden; ">
        <div id="ticketGrid"></div>
    </div>





</div>




<!-- Close Confirmation Modal -->
<div class="modal fade" id="closeTicketModal" tabindex="-1" aria-labelledby="closeTicketModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 650px;">
        <div class="modal-content border-0 shadow rounded-0" style="font-family: 'Open Sans','Segoe UI'; font-size: 14px;">


            <div class="modal-header px-4 pt-3 pb-2 border-bottom-0">
                <h6 class="modal-title fw-bold" id="closeTicketModalLabel" style="font-size: 16px; color: #6e6e6e;">
                    Close Ticket(s)
                </h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>


            <div class="modal-body px-0 pt-2 pb-0">


                <div class="w-100 py-2 px-4 mb-3" style="background-color: #f0f0f0;">
                    This action will close the selected ticket(s)
                </div>


                <div class="px-4">

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="sendEmailCheckbox">
                        <label class="form-check-label" for="sendEmailCheckbox" style="font-weight: 500;">
                            Send Email to the User who submitted this ticket confirming that the ticket has been closed.
                        </label>
                    </div>


                    <div class="mb-2">
                        <label for="closeNotes" class="form-label mb-1 fw-semibold">Notes</label>
                        <div style="width: 100%;">
                            <textarea class="form-control"
                                      id="closeNotes"
                                      rows="4"
                                      maxlength="1000"
                                      style="resize: none; width: 100%; border: 1px solid #ced4da;"></textarea>
                        </div>
                        <style>
                            #closeNotes {
                                width: 100% !important;
                                min-width: 100% !important;
                                height: 200px !important;
                            }
                        </style>
                        <div class="text-end small text-muted mt-1">
                            <span id="notesCharCount">0</span>/1000
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer border-top-0 px-4 pb-3 justify-content-between">
                <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal" style="width: 150px; font-size: 13px; font-family: 'Open Sans', 'Segoe UI';  color: black;  letter-spacing: 6px; ">CANCEL</button>
                <button type="button" class="btn " id="confirmCloseTicket" style="width: 150px; font-size: 13px; font-family: 'Open Sans', 'Segoe UI'; background-color: #0091ff; color: white; font-weight:400; letter-spacing: 6px;">DONE</button>

            </div>

        </div>
    </div>
</div>

@Html.Partial("_NewTicketModal")
@Html.Partial("_AssignOwnerModal")
@Html.Partial("_AssignToModal")

<script>
    $(document).ready(function () {
        const $input = $('#customSearch');
        const $clearIcon = $('#clearSearch');

        // Show/hide clear icon when input changes
        $input.on('input', function () {
            $clearIcon.toggle($(this).val().length > 0);
        });

        // Prevent blur before clear by using mousedown instead of click
        $clearIcon.on('mousedown', function (e) {
            e.preventDefault(); // Prevent input from losing focus
            $input.val('').trigger('input'); // Clear input instantly
        });
    });
</script>




@section Scripts {
    <script src="~/js/ticket-modals.js"></script>
    <script src="~/Scripts/Ticket/ticket-grid.js"></script>
    <script src="~/Scripts/Ticket/new-ticket.js"></script>
    <script src="~/Scripts/ticket-grid.js"></script>
    <script src="~/Scripts/action-dropdown.js"></script>
    <script src="~/Scripts/Ticket/edit-ticket.js"></script>
    <script src="~/Scripts/Ticket/delete-ticket.js"></script>
    <script src="~/Scripts/Ticket/view-ticket.js"></script>
    <script src="~/Scripts/Ticket/view-history.js"></script>
    <script src="~/Scripts/Ticket/AssignOwner.js"></script>
    <script src="~/Scripts/Ticket/AssignToModal.js"></script>
    <script src="~/Scripts/Ticket/description-template.js"></script>


}


@Html.Partial("_DeleteTicketModal")
@Html.Partial("_ViewTicketModal")
@Html.Partial("_ViewHistoryModal")
@Html.Partial("_EditTicketModal")
@Html.Partial("_ToastPartial")



